<!DOCTYPE html>
<html>
<head>
<title>Scan QR & Pay</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial, sans-serif;background:#f2f2f2;margin:0;padding:0;}
.container{max-width:500px;margin:30px auto;background:white;padding:25px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.25);}
h2{text-align:center;margin-bottom:20px;color:#333;}
.qr{margin-top:20px;text-align:center;}
.qr img{width:80%; max-width:250px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.2);}
label{display:block;margin-top:15px;font-weight:bold;color:#555;}
input{width:100%;padding:12px;margin-top:5px;border-radius:8px;font-size:16px;border:1px solid #ccc;}
.total{font-weight:bold;font-size:16px;margin-top:15px;color:#222;}
</style>
</head>
<body>

<div class="container">
<h2>Scan QR & Pay</h2>

<div class="qr" id="qrContainer">
    <!-- QR will appear here -->
</div>

<label>Enter Transaction ID (TID) after payment:</label>
<input type="text" id="tidInput" placeholder="Enter 10-character TID">

<div class="total" id="totalAmount"></div>

</div>

<script>
// QR file
const qrImage = "images/IMG_20260214_075835_541.png";

// Load checkout data
const data = JSON.parse(localStorage.getItem("checkoutData"));

// Show QR and total based on payment
const qrDiv = document.getElementById("qrContainer");
const totalDiv = document.getElementById("totalAmount");

if(data.payment === "cod"){
    qrDiv.innerHTML = `<p>Scan QR to pay ₹40 Online Packing</p><img src="${qrImage}" alt="QR">`;
    totalDiv.innerText = "COD Amount: ₹60 + Packing ₹40 Paid Online";
} else{
    qrDiv.innerHTML = `<p>Scan QR to pay ₹100 Full Online</p><img src="${qrImage}" alt="QR">`;
    totalDiv.innerText = "Total Online Payment: ₹100";
}

const tidInput = document.getElementById("tidInput");

// Auto-confirm after valid TID
tidInput.addEventListener("input", ()=>{
    const tid = tidInput.value.trim();
    if(/^[A-Za-z0-9]{10}$/.test(tid)){
        autoConfirmOrder(tid);
    }
});

function autoConfirmOrder(tid){
    // Auto alert + order confirm
    let message = `✅ Order Confirmed!\n\nName: ${data.name}\nPhone: ${data.phone}\nEmail: ${data.email}\nAddress: ${data.address}\nPincode: ${data.pincode}\nState: ${data.state}\nTransaction ID: ${tid}\n`;
    if(data.payment === "cod"){
        message += "Payment: COD ₹60 + Packing ₹40 Paid Online";
    } else{
        message += "Payment: Full Online ₹100 Paid";
    }

    alert(message);
    // Clear localStorage and redirect
    localStorage.removeItem("checkoutData");
    window.location.href = "index.html";
}
</script>

</body>
</html>
